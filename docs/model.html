<!DOCTYPE html>

<html>
<head>
  <title>model.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="ModelSpec.html">
                ModelSpec.js
              </a>
            
              
              <a class="source" href="model.html">
                model.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>model.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>A functional reactive model library.</p>
<p>By Curran Kelleher 4/17/2014</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> model = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span class="hljs-pi">  'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="model-">Model()</h1>
<p>The constructor function for models.
No need to use <code>new</code>.</p>
<p>For example: <code>var model = Model();</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Model</span><span class="hljs-params">()</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The <code>model</code> API has only three functions: <code>get</code>, <code>set</code> and <code>when</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> model = {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="model-set">model.set</h2>
<p>Sets model properties.</p>
<ul>
<li><code>model.set(property, value)</code> sets a property to the given value.<ul>
<li><code>property</code> a string, the property name</li>
<li><code>value</code> the value assigned to the property (any type)</li>
</ul>
</li>
<li><code>model.set(object)</code> sets the value of model properties
based on the key-value pairs present in the given object.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>          set: set,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="model-get">model.get</h2>
<p>Gets model properties.</p>
<ul>
<li><code>model.get(property)</code> gets the value of the given property<ul>
<li><code>property</code> a string, the property name</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>          get: get,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="model-when">model.when</h2>
<p>Listens for changes on the model such that:</p>
<ul>
<li>Multiple sequential model updates cause the callback
to execute only once</li>
<li>The callback is only executed if all dependency property
values are defined</li>
</ul>
<p><code>model.when(dependencies, callback [, thisArg])</code></p>
<ul>
<li><code>dependencies</code> specifies the names of model properties that are
dependencies of the callback function. <code>dependencies</code> can be<ul>
<li>a string (in the case of a single dependency) or</li>
<li>an array of strings (in the case of many dependencies).</li>
</ul>
</li>
<li><code>callback(values...)</code> the callback function that is invoked after dependency
properties change. The values of dependency properties are passed
as arguments to the callback, in the same order specified by <code>dependencies</code>.</li>
<li><code>thisArg</code> value to use as <code>this</code> when executing <code>callback</code>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>          when: when
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h1 id="internals">Internals</h1>
<p><code>callbacks</code> is an object containing callback functions.</p>
<ul>
<li>Keys are property names</li>
<li>Values are arrays of callback functions</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        callbacks = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><code>values</code> is an object containing property values.</p>
<ul>
<li>Keys are property names</li>
<li>Values are values set on the model</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        values = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="set">set</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span><span class="hljs-params">(keyOrObject, value)</span>{</span>
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> keyOrObject === <span class="hljs-string">'string'</span>) {
        setKeyValue(keyOrObject, value);
      } <span class="hljs-keyword">else</span> {
        setObject(keyOrObject);
      }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setObject</span><span class="hljs-params">(object)</span>{</span>
      <span class="hljs-built_in">Object</span>.keys(object).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
        setKeyValue(key, object[key]);
      });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setKeyValue</span><span class="hljs-params">(key, value)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Update the internal value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      values[key] = value;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Call callbacks if there are any.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(callbacks[key]){
        callbacks[key].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> {</span>
          callback();
        });
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2 id="get">get</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span><span class="hljs-params">(key)</span>{</span>
      <span class="hljs-keyword">return</span> values[key];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="when">when</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">when</span><span class="hljs-params">(dependencies, fn, thisArg)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Support passing a single string as <code>dependencies</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(!(dependencies <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>)) {
        dependencies = [dependencies];
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><code>callFn()</code> will invoke <code>fn</code> with values of dependency properties
on the next tick of the JavaScript event loop.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> callFn = debounce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Extract the values for each dependency property from the model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> args = dependencies.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dependency)</span> {</span>
          <span class="hljs-keyword">return</span> values[dependency];
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Only call the function if all values are defined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(allAreDefined(args)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Call <code>fn</code> with the dependency property values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          fn.apply(thisArg, args);
        }
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Invoke <code>fn</code> once for initialization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      callFn();</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Invoke <code>fn</code> when dependency properties change.</p>
<p>Multiple sequential dependency property changes
result in only a single invocation of <code>fn</code>
because callFn is <a href="underscorejs.org/#debounce">debounced</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dependencies.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(property)</span>{</span>
        on(property, callFn);
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Adds a callback that will listen for changes
to the specified property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span><span class="hljs-params">(key, callback)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If there is not already a list
of callbacks for the given key,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(!callbacks[key]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>then create one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        callbacks[key] = [];
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Add the callback to the list of callbacks
for the given key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      callbacks[key].push(callback);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Return the public Model API,
using the revealing module pattern.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> model;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Returns a debounced version of the given function.
Calling the debounced function one or more times in sequence
will schedule the given function to execute only once
at the next tick of the JavaScript event loop.
Similar to <a href="http://underscorejs.org/#debounce">http://underscorejs.org/#debounce</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span><span class="hljs-params">(func)</span>{</span>
    <span class="hljs-keyword">var</span> queued = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span>(!queued){
        queued = <span class="hljs-literal">true</span>;
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
          queued = <span class="hljs-literal">false</span>;
          func();
        }, <span class="hljs-number">0</span>);
      }
    };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Returns true if all values in the given array
are defined and not null, false otherwise.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allAreDefined</span><span class="hljs-params">(arr)</span>{</span>
    <span class="hljs-keyword">var</span> allDefined = <span class="hljs-literal">true</span>;
    arr.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> d === <span class="hljs-string">'undefined'</span> || d === <span class="hljs-literal">null</span>){
        allDefined = <span class="hljs-literal">false</span>;
      }
    });
    <span class="hljs-keyword">return</span> allDefined;
  }

  <span class="hljs-keyword">return</span> Model;
}).call(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
